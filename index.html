<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç”Ÿæ—¥å¿«ä¹ å…ƒå­</title>
<link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  overflow:hidden;
  font-family:'ZCOOL KuaiLe', cursive;
  background:black;
  color:white;
  text-align:center;
}

/* æ˜Ÿç©º + æµæ˜Ÿ */
canvas{ position:fixed; top:0; left:0; }

/* ä¸»å†…å®¹ */
.container{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  display:flex;
  flex-direction:column;
  align-items:center;
  z-index:10;
}

/* è›‹ç³• */
#cake{
  font-size:90px;
  margin-bottom:10px;
  animation:float 3s infinite ease-in-out;
}
@keyframes float{
  0%{transform:translateY(0)}
  50%{transform:translateY(-15px)}
  100%{transform:translateY(0)}
}

/* èœ¡çƒ›ç«ç„° */
#candle{
  position:relative;
  font-size:40px;
  margin-bottom:20px;
}
.flame{
  width:14px;
  height:26px;
  background:radial-gradient(circle,#ffd54f,#ff6f00);
  border-radius:50%;
  position:absolute;
  left:50%;
  top:-28px;
  transform:translateX(-50%);
  animation:flicker .15s infinite;
}
@keyframes flicker{
  0%{transform:translateX(-50%) scale(1)}
  50%{transform:translateX(-50%) scale(1.2)}
  100%{transform:translateX(-50%) scale(1)}
}

h1{ font-size:36px; margin-bottom:10px; }
.subtitle{ opacity:0.9; margin-bottom:20px; }

button{
  padding:16px 32px;
  font-size:20px;
  border:none;
  border-radius:40px;
  background:white;
  color:#ff4d6d;
  box-shadow:0 8px 25px rgba(0,0,0,0.25);
}
button:active{ transform:scale(0.9); }

#message{
  margin-top:20px;
  font-size:22px;
  line-height:1.7;
  min-height:120px;
  white-space:pre-line;
}

/* ä¿¡å° */
#letter{
  position:absolute;
  bottom:-100%;
  width:85%;
  background:white;
  color:#333;
  border-radius:20px;
  padding:25px;
  font-size:18px;
  line-height:1.7;
  transition:1.2s;
}

/* çƒŸèŠ±æ–‡å­— */
#fireworks-text{
  position:absolute;
  top:30%;
  left:50%;
  transform:translateX(-50%);
  font-size:48px;
  font-family:'ZCOOL KuaiLe', cursive;
  color:#ff4081;
  opacity:0;
  z-index:12;
  text-shadow:0 0 12px #fff,0 0 24px #ff4081;
}

/* ç§»åŠ¨ç«¯æç¤º */
#mobile-tip{
  display:none;
  color:#ff4081;
  margin-top:10px;
  font-size:18px;
}
</style>
</head>
<body>

<canvas id="sky"></canvas>
<canvas id="fireworks"></canvas>

<div class="container" id="main">
  <div id="cake">ğŸ‚</div>
  <div id="candle">ğŸ•¯ï¸<div class="flame" id="flame"></div></div>
  <h1>å…ƒå­ç”Ÿæ—¥å¿«ä¹</h1>
  <div class="subtitle">å°å¿ƒï¼æœ‰äººå‡†å¤‡ä¸€å±•çƒ‚æ­Œå–‰</div>
  <button id="play-btn">ç‚¹ä¸€ä¸‹æ’­æ”¾ç”Ÿæ—¥æ­Œ ğŸµ</button>
  <div id="message"></div>
  <div id="mobile-tip">âš ï¸ æ‰‹æœºé™éŸ³æˆ–æœªå…è®¸æ’­æ”¾ï¼Œè¯·æ‰“å¼€éŸ³é‡</div>
</div>

<div id="letter">
ç”Ÿæ—¥å¿«ä¹ã€‚  

æ„¿ä½ è¿™ä¸€å¹´  
ä»¥åŠæ°¸æ°¸è¿œè¿œ  
å¹¸ç¦å¿«ä¹  

ä¹è«ä¹å…®å¿ƒç›¸çŸ¥  

â¤ï¸
</div>

<div id="fireworks-text">ç”Ÿæ—¥å¿«ä¹ å…ƒå­</div>

<audio id="song" preload="auto">
  <source src="song.mp3" type="audio/mpeg">
</audio>

<script>
// ===== æ˜Ÿç©ºç²’å­ + æµæ˜Ÿ =====
const sky=document.getElementById("sky"), ctx=sky.getContext("2d");
sky.width=window.innerWidth; sky.height=window.innerHeight;
let stars=[], meteors=[];
for(let i=0;i<200;i++){stars.push({x:Math.random()*sky.width, y:Math.random()*sky.height, r:Math.random()*1.5, a:Math.random()});}
function drawStars(){
  ctx.clearRect(0,0,sky.width,sky.height);
  stars.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle="rgba(255,255,255,"+s.a+")";
    ctx.fill();
    s.a+=Math.random()*0.05-0.02;
    if(s.a<0)s.a=0; if(s.a>1)s.a=1;
  });
  meteors.forEach(m=>{
    ctx.beginPath();
    ctx.moveTo(m.x,m.y); ctx.lineTo(m.x+m.dx, m.y+m.dy);
    ctx.strokeStyle="rgba(255,255,255,"+m.a+")"; ctx.lineWidth=2; ctx.stroke();
    m.x+=m.vx; m.y+=m.vy; m.a-=0.02;
  });
  meteors=meteors.filter(m=>m.a>0);
  requestAnimationFrame(drawStars);
}
drawStars();
function launchMeteor(){
  meteors.push({x:Math.random()*sky.width,y:0,dx:Math.random()*80+50,dy:Math.random()*30+10,vx:4+Math.random()*2,vy:2+Math.random()*1,a:1});
}
setInterval(launchMeteor,2000);

// ===== çƒŸèŠ± =====
const canvas=document.getElementById("fireworks"), c=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
let particles=[];
function explode(x,y,color){
  for(let i=0;i<100;i++){
    particles.push({x:x,y:y,vx:(Math.random()-0.5)*6,vy:(Math.random()-0.5)*6,life:100,color:color});
  }
}
function drawFireworks(){
  c.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach((p,i)=>{
    c.beginPath();
    c.arc(p.x,p.y,2,0,Math.PI*2);
    c.fillStyle=p.color;
    c.fill();
    p.x+=p.vx; p.y+=p.vy; p.life--;
  });
  particles=particles.filter(p=>p.life>0);
  requestAnimationFrame(drawFireworks);
}
drawFireworks();

// ===== çƒŸèŠ±æ–‡å­— =====
function showFireworksText(){
  const txt=document.getElementById("fireworks-text");
  txt.style.opacity=1;
  for(let i=0;i<txt.textContent.length;i++){
    explode(canvas.width/2,canvas.height/3,`hsl(${Math.random()*360},100%,70%)`);
  }
}

// ===== ä¸»æµç¨‹ =====
const playBtn=document.getElementById("play-btn");
const audio=document.getElementById("song");

playBtn.addEventListener("click",()=>{
  // ç”¨æˆ·ç‚¹å‡»è§¦å‘æ’­æ”¾
  const playPromise = audio.play();
  if(playPromise !== undefined){
    playPromise.then(()=>{
      console.log("æ’­æ”¾æˆåŠŸ");
      playBtn.style.display="none";
      document.getElementById("mobile-tip").style.display="none";
      typeText();
      setInterval(()=>{explode(Math.random()*canvas.width,Math.random()*canvas.height/2,`hsl(${Math.random()*360},100%,70%)`)},800);
      setTimeout(showFireworksText,4000);
    }).catch(()=>{
      // æ‰‹æœºå¯èƒ½é™éŸ³
      document.getElementById("mobile-tip").style.display="block";
    });
  }
});

// æ‰“å­—åŠ¨ç”»
let text="â¤ï¸æ„¿å¿æ­¤æ—¥ç”ŸåŒç¿¼\nè´¨æœ¬æ´æ¥è¿˜æ´å»\nè‡ªç”±å‹‡æ•¢\nå¹¸ç¦åšè‡ªå·±\n\nè¯·å¹ç­èœ¡çƒ› ğŸ‚";
let i=0;
function typeText(){
  if(i<text.length){
    document.getElementById("message").innerHTML+=text.charAt(i);
    i++;
    setTimeout(typeText,80);
  } else { startMic(); }
}

// éº¦å…‹é£å¹èœ¡çƒ›
function startMic(){
  navigator.mediaDevices.getUserMedia({audio:true})
  .then(stream=>{
    const audioContext=new AudioContext();
    const mic=audioContext.createMediaStreamSource(stream);
    const analyser=audioContext.createAnalyser();
    mic.connect(analyser);
    let data=new Uint8Array(analyser.frequencyBinCount);
    function detect(){
      analyser.getByteFrequencyData(data);
      let volume=data.reduce((a,b)=>a+b)/data.length;
      if(volume>60){ blowCandle(); }
      requestAnimationFrame(detect);
    }
    detect();
  }).catch(()=>{console.log("éº¦å…‹é£æƒé™æœªå…è®¸");});
}

// å¹ç­èœ¡çƒ›
function blowCandle(){
  document.getElementById("flame").style.display="none";
  document.getElementById("message").innerHTML+="\n\næ„¿æœ›ä¼šå®ç°çš„ âœ¨";
  showLetter();
}

// ä¿¡å°å‡ºç°
function showLetter(){
  setTimeout(()=>{document.getElementById("letter").style.bottom="50px";},1500);
}
</script>
</body>
</html>
